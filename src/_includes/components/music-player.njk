{# MIDI/Background Music Player Widget #}

{% if site.modules.musicPlayer %}
<div class="widget widget-music-player">
  <h2 class="widget-title">üéµ Background Music</h2>
  <div class="widget-content">
    <div class="music-player-control">
      <button id="music-toggle" class="music-btn" aria-label="Toggle music">
        <span class="play-icon">‚ñ∂Ô∏è</span>
        <span class="pause-icon" style="display: none;">‚è∏Ô∏è</span>
      </button>
      <div class="music-info">
        <p class="music-title">Retro MIDI Vibes</p>
        <input type="range" id="volume-control" min="0" max="100" value="50" aria-label="Volume control">
      </div>
    </div>
    <div class="playlist">
      <p style="font-size: 0.875rem;">
        <small>üé∂ Classic MIDI soundtrack</small>
      </p>
    </div>
  </div>
</div>

<audio id="background-music" loop>
  <source src="/audio/background-music.mp3" type="audio/mpeg">
  <source src="/audio/background-music.ogg" type="audio/ogg">
  Your browser does not support the audio element.
</audio>

<script>
(function() {
  const audio = document.getElementById('background-music');
  const toggleBtn = document.getElementById('music-toggle');
  const volumeControl = document.getElementById('volume-control');
  const playIcon = toggleBtn.querySelector('.play-icon');
  const pauseIcon = toggleBtn.querySelector('.pause-icon');
  
  // Check user preference
  const musicEnabled = localStorage.getItem('music-enabled') !== 'false';
  const savedVolume = localStorage.getItem('music-volume') || 50;
  
  audio.volume = savedVolume / 100;
  volumeControl.value = savedVolume;
  
  toggleBtn.addEventListener('click', function() {
    if (audio.paused) {
      audio.play();
      playIcon.style.display = 'none';
      pauseIcon.style.display = 'inline';
      localStorage.setItem('music-enabled', 'true');
    } else {
      audio.pause();
      playIcon.style.display = 'inline';
      pauseIcon.style.display = 'none';
      localStorage.setItem('music-enabled', 'false');
    }
  });
  
  volumeControl.addEventListener('input', function() {
    audio.volume = this.value / 100;
    localStorage.setItem('music-volume', this.value);
  });
  
  // Auto-play if enabled (with user interaction requirement)
  document.addEventListener('click', function initMusic() {
    if (musicEnabled) {
      audio.play().catch(() => {
        // Autoplay prevented, user needs to click play button
      });
    }
    document.removeEventListener('click', initMusic);
  }, { once: true });
})();
</script>

<style>
.widget-music-player {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
}

.music-player-control {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 5px;
}

.music-btn {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #fff;
  border: 3px solid #000;
  cursor: pointer;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s;
}

.music-btn:hover {
  transform: scale(1.1);
}

.music-info {
  flex: 1;
}

.music-title {
  margin: 0 0 0.5rem 0;
  font-weight: bold;
  font-size: 1rem;
}

#volume-control {
  width: 100%;
}

.playlist {
  margin-top: 0.5rem;
  text-align: center;
}
</style>
{% endif %}
